!function(){"use strict";var t=document,e=window,n=navigator,r=e.encodeURIComponent,i=e.decodeURIComponent;function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(t,e)||d(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||d(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return t.length>e?Array.from(t).slice(0,e-n.length).join("")+n:t}var p=function(){function t(e){a(this,t),this.map={},this.ttl=e}return s(t,[{key:"add",value:function(t){var e=this,n=this.constructor.hash(t);this.map[n]=setTimeout((function(){return clearTimeout(e.map[n]),void delete e.map[n]}),this.ttl)}},{key:"has",value:function(t){var e=this.constructor.hash(t);return!!this.map[e]}}],[{key:"hash",value:function(t){return function(t){for(var e=0,n=0;n<t.length;n+=1)e=Math.imul(31,e)+t.charCodeAt(n)|0;return e}(JSON.stringify(t))}}]),t}(),g=function(){function e(){a(this,e),this.supported=!0}return s(e,[{key:"get",value:function(e){var n="; ".concat(t.cookie).split("; ".concat(e,"="));return 2===n.length?i(n.pop().split(";").shift()):null}},{key:"set",value:function(e,n,i){var a=new Date;a.setTime(a.getTime()+864e5*i);var o="; expires=".concat(a.toGMTString());return t.cookie="".concat(e,"=").concat(r(n)).concat(o,"; path=/"),n}},{key:"del",value:function(t){this.set(t,"",-1)}}]),e}(),m=function(){function t(e){a(this,t),this.prefix=e,this.ttl=30,this.storage=new g}return s(t,[{key:"get",value:function(t){return this.storage.get(this.prefix+t)}},{key:"set",value:function(t,e){return this.storage.set(this.prefix+t,e,this.ttl)}},{key:"del",value:function(t){this.storage.del(this.prefix+t)}},{key:"incr",value:function(t){var e=parseInt(this.get(t),10)||0;return this.set(t,e+1)}}]),t}(),b="sendBeacon"in n,k="Blob"in e,w=function(){function t(e,n){a(this,t),this.url=e,this.data=this.constructor.encodeQueryData(n),this.contentType="application/x-www-form-urlencoded",this.supportsSendBeacon=b&&k}return s(t,[{key:"send",value:function(){this.sendBeacon()||this.sendXHR()}},{key:"sendBeacon",value:function(){if(!this.supportsSendBeacon)return!1;var t={type:this.contentType},e=new Blob([this.data],t);return n.sendBeacon(this.url,e)}},{key:"sendXHR",value:function(){var t=this,e=new XMLHttpRequest;e.open("POST",this.url,!0),e.setRequestHeader("Content-Type",this.contentType),e.onreadystatechange=function(){4===t.readyState&&t.status>=200&&t.status},e.send(this.data)}}],[{key:"encodeQueryData",value:function(t){var e=[],n=function(t,n){null!==n&&""!==n&&e.push("".concat(t,"=").concat(r(n)))};return Object.keys(t).forEach((function(e){var r=t[e];Array.isArray(r)?r.forEach((function(t){return n(e,t)})):n(e,r)})),e.join("&")}}]),t}();function O(t,e,n,r){t.addEventListener(e,n,!!r)}var S=function(){function t(e){a(this,t),this.name="pageview",this.tracker=e,this.started=!1,this.init()}return s(t,[{key:"init",value:function(){var t=this;O(e,"unload",(function(){return t.pageleave()}))}},{key:"handle",value:function(t){this.started&&this.pageleave(),this.pageview(t)}},{key:"pageview",value:function(t){this.started=!0;var n=t?JSON.stringify(t):null;this.tracker.send(this.name,l({ex:n},function(){var t={us:"source",um:"medium",uk:"campaign",uc:"content",ut:"term"},n={},r=new URLSearchParams(e.location.search);return Object.keys(t).forEach((function(e){var i="utm_".concat(t[e]);r.has(i)&&(n[e]=r.get(i))})),n}()))}},{key:"pageleave",value:function(){this.started&&(this.started=!1,this.tracker.send("pageleave"))}}]),t}();var j=function(){function n(t){a(this,n),this.name="scroll",this.tracker=t,this.threshold=10,this.maxScroll=0,this.lastScroll=0,this.init()}return s(n,[{key:"init",value:function(){var n=this;!function(e){if("loading"===t.readyState){var n="DOMContentLoaded";O(t,n,(function r(){var i,a,o;i=n,a=r,t.removeEventListener(i,a,!!o),e()}))}else e()}((function(){var t,r,i;O(e,"scroll",(t=function(){return n.handle()},r=1e3,function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var o=function(){t.apply(void 0,n),clearTimeout(i),i=null};i||(i=setTimeout(o,r))}))}))}},{key:"handle",value:function(){var n=t.body,r=t.documentElement,i=Math.max(0,Math.round(e.pageYOffset)),a=e.innerHeight,o=Math.max(r.scrollHeight,r.offsetHeight,r.clientHeight,n.scrollHeight,n.offsetHeight,n.clientHeight),s=o-a,u=Math.round(i/s*100),c=Math.min(100,Math.max(0,u||0)),l=100===c&&100!==this.maxScroll,h=Math.abs(c-this.lastScroll);(l||h>=this.threshold)&&(this.lastScroll=c,c>this.maxScroll&&(this.maxScroll=c),this.tracker.send(this.name,{dh:o,wh:a,to:i,cs:c,ms:this.maxScroll}))}}]),n}(),T=function(){function r(t,e,n){var i=this;for(a(this,r),this.url=t,this.sdk=n,this.request=null,this.store=new m("_rs_"),this.queue=e||[],this.plugins=[],this.sentLog=new p(1e3),this.initialized=!1,[new S(this),new j(this)].forEach((function(t){return i.register(t.name,t)}));this.queue.length;)this.handle.apply(this,f(this.queue.shift()))}return s(r,[{key:"init",value:function(t){if(this.initialized)throw new Error("tracker already initialized");this.id=t,this.initialized=!0}},{key:"register",value:function(t,e){this.plugins[t]=e}},{key:"handle",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i;"init"!==t?this.initialized&&("identify"!==t?"function"!=typeof t?this.plugins[t]&&(i=this.plugins[t]).handle.apply(i,n):t(this):this.identify(n[0])):this.init(n[0])}},{key:"identify",value:function(t){this.userId=t}},{key:"send",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.initialized){var n=l({en:t},e);this.sentLog.has(n)||(this.sendRequest(n),this.sentLog.add(n))}}},{key:"getDeviceID",value:function(){var t=this.store.get("uid")||([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^16*Math.random()>>t/4).toString(16)}));return this.store.set("uid",t)}},{key:"sendRequest",value:function(r){var i,a,o=h((i=(n.language||"").toLowerCase().split("-"),[(a=function(t){return t&&2===t.length?t:""})(i[0]),a(i[1])]),2),s=o[0],u=o[1],c=this.store.incr("n"),f={title:v(t.title,100),url:e.location.href,referrer:t.referrer||null},d=f.title,y=f.url,p=f.referrer,g=l(l({id:this.id,pt:d,pu:y,pr:p,sd:this.getDeviceID(),su:this.userId||null},r),{},{dl:s,dc:u,ts:Math.floor(Date.now()/1e3),tz:-Math.round((new Date).getTimezoneOffset()),rn:c,cn:this.sdk.name,cv:this.sdk.version});new w(this.url,g).send()}}]),r}(),x=e.RsObject||"rs";if(e[x]=e[x]||{},e.recsys=e.recsys||{},e.recsys.Tracker)throw new Error("tracker already loaded");var A=new T("https://click.recsys.io/events",e[x].q,{name:"web-tracker",version:"0.1.0"});e[x]=function(){return A.handle.apply(A,arguments)},e.recsys.Tracker=A}();
